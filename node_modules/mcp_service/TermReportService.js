var async = require('async');

var dc = require("mcp_db").dc;

var esut = require('easy_util');
var log = esut.log;

var config = require('mcp_config');
var ec = config.ec;

var cons = require('mcp_constants');
var userType = cons.userType;
var msgStatus = cons.msgStatus;
var msgType = cons.msgType;
var ticketPrintQueenStatus = cons.ticketPrintQueenStatus;
var ticketPrintStatus = cons.ticketPrintStatus;
var ticketStatus = cons.ticketStatus;
var termStatus = cons.termStatus;

var config = require('mcp_config');
var prop = config.prop;

var transaction = require('./Transaction.js');


var TermReportService = function(){};

/**
 * 保存期次报表
 * @param cb
 */
TermReportService.prototype.saveList = function(term, list, cb)
{
    var self = this;
    //如果不存在，需要补0的字段
    var keyList = {'hitCount':0, 'hitAmount':0, 'bonus':0, 'bonusBeforeTax':0,
        'notHitCount':0, 'notHitAmount':0, 'failCount':0, 'failAmount':0};
    var rst = [];
    for(var key in list)
    {
        var set = list[key];
        set.gameCode = term.gameCode;
        set.termCode = term.code;
        for(var nKey in keyList)
        {
            if(set[nKey] == undefined)
            {
                set[nKey] = keyList[nKey];
            }
        }
        rst[rst.length] = set;
    }
    var table = dc.main.get("termreport");
    async.eachSeries(rst, function(rpt, callback) {
        table.save(rpt, {}, function(err, data){
            callback(err);
        });
    }, function(err){
        cb(err, rst);
    });
}

module.exports = new TermReportService();